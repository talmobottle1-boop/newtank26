<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OXBIT | Professional Crypto DEX</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: { 'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <!-- React & Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }
        
        .chart-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #f8fafc;
        }
        .dark .chart-container {
            background: #0f172a;
        }
        @media (max-width: 768px) {
            .chart-container { height: 350px; }
        }

        /* Chart Overlay Animations */
        .price-line-anim {
            transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Custom Range Slider */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #0ea5e9;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(14, 165, 233, 0.5);
        }

        /* Profit Card Overlay */
        .profit-card-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        const App = () => {
            // State Management
            const [btcPrice, setBtcPrice] = useState(0);
            const [tickerData, setTickerData] = useState({ p: 0, h: 0, l: 0, v: 0 });
            const [isDark, setIsDark] = useState(false); // Initial State: Light Mode
            const [leverage, setLeverage] = useState(10);
            const [activeSide, setActiveSide] = useState('long');
            const [orderAmount, setOrderAmount] = useState('');
            const [positions, setPositions] = useState([]);
            const [mobileTab, setMobileTab] = useState('trade');
            const [walletConnected, setWalletConnected] = useState(false);
            const [shareModal, setShareModal] = useState(null); 

            // Refs for Audio
            const openAudio = useRef(new Audio("https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"));
            const closeAudio = useRef(new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"));

            // Theme Toggle
            useEffect(() => {
                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDark]);

            // WebSocket: Binance Live Data
            useEffect(() => {
                const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
                ws.onmessage = (e) => {
                    const d = JSON.parse(e.data);
                    setBtcPrice(parseFloat(d.c));
                    setTickerData({
                        p: parseFloat(d.P),
                        h: parseFloat(d.h),
                        l: parseFloat(d.l),
                        v: parseFloat(d.q)
                    });
                };
                return () => ws.close();
            }, []);

            // Refresh Icons on UI Updates
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [mobileTab, positions, isDark, btcPrice === 0, shareModal]);

            // Trading Logic
            const handleTrade = () => {
                const amount = parseFloat(orderAmount);
                if (!amount || amount <= 0) return;

                const newPos = {
                    id: Date.now(),
                    entry: btcPrice,
                    size: (amount * leverage) / btcPrice,
                    margin: amount,
                    leverage: leverage,
                    side: activeSide,
                    symbol: 'BTCUSDT'
                };

                setPositions(prev => [newPos, ...prev]);
                setOrderAmount('');
                openAudio.current.play().catch(() => {});
            };

            const closePos = (id) => {
                setPositions(prev => prev.filter(p => p.id !== id));
                closeAudio.current.play().catch(() => {});
            };

            // Helpers
            const getPnL = (pos) => {
                const diff = btcPrice - pos.entry;
                const pnl = pos.side === 'long' ? diff * pos.size : -diff * pos.size;
                const roe = (pnl / pos.margin) * 100;
                const liq = pos.side === 'long' 
                    ? pos.entry * (1 - 0.95/pos.leverage) 
                    : pos.entry * (1 + 0.95/pos.leverage);
                return { pnl, roe, liq };
            };

            const getPriceY = (price) => {
                if (!btcPrice) return '50%';
                const zoom = 0.05; 
                const offset = ((price - btcPrice) / btcPrice) * (100 / zoom);
                const y = 50 - offset;
                return `${Math.max(5, Math.min(95, y))}%`;
            };

            // Components
            const NavItem = ({ id, icon, label }) => (
                <button 
                    onClick={() => setMobileTab(id)}
                    className={`flex flex-col items-center gap-1 flex-1 transition-all ${mobileTab === id ? 'text-sky-500' : 'text-slate-400'}`}
                >
                    <i data-lucide={icon} className="w-5 h-5"></i>
                    <span className="text-[8px] font-black uppercase">{label}</span>
                </button>
            );

            // Share Modal Component
            const ShareCard = ({ pos, onClose }) => {
                const { pnl, roe } = getPnL(pos);
                return (
                    <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                        <div className="bg-slate-900 w-full max-w-sm rounded-[32px] overflow-hidden shadow-2xl relative border border-slate-800 animate-in zoom-in-95 duration-200">
                            <button onClick={onClose} className="absolute top-4 right-4 text-white/40 hover:text-white z-10"><i data-lucide="x" className="w-5 h-5"></i></button>
                            
                            <div className="p-8 pb-12 profit-card-gradient relative overflow-hidden">
                                <div className="absolute top-[-20%] right-[-10%] w-40 h-40 bg-sky-500/20 rounded-full blur-[80px]"></div>
                                
                                <div className="flex justify-between items-start mb-10">
                                    <div>
                                        <div className="text-sky-500 text-[10px] font-black uppercase tracking-[0.2em] mb-1">Profit Certificate</div>
                                        <h4 className="text-white text-2xl font-black">{pos.symbol} <span className={pos.side === 'long' ? 'text-emerald-400' : 'text-rose-400'}>{pos.side.toUpperCase()}</span></h4>
                                        <div className="text-white/40 text-[10px] font-bold uppercase mt-1">{pos.leverage}x Isolated</div>
                                    </div>
                                    <div className="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-md">
                                        <i data-lucide="activity" className="w-6 h-6 text-sky-400"></i>
                                    </div>
                                </div>

                                <div className="mb-10">
                                    <div className="text-white/40 text-[10px] font-black uppercase tracking-widest mb-1">Return on Equity</div>
                                    <div className={`text-5xl font-black tracking-tighter ${roe >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                                        {roe >= 0 ? '+' : ''}{roe.toFixed(2)}%
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <div className="text-white/20 text-[8px] font-black uppercase mb-1">Entry Price</div>
                                        <div className="text-white font-mono text-sm">${pos.entry.toLocaleString()}</div>
                                    </div>
                                    <div>
                                        <div className="text-white/20 text-[8px] font-black uppercase mb-1">Mark Price</div>
                                        <div className="text-white font-mono text-sm">${btcPrice.toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-slate-950 p-6 flex justify-between items-center">
                                <div className="flex items-center gap-2">
                                    <div className="w-6 h-6 bg-sky-500 rounded-lg flex items-center justify-center">
                                        <i data-lucide="activity" className="w-3 h-3 text-white"></i>
                                    </div>
                                    <span className="text-white font-black text-xs tracking-tighter">OX<span className="text-sky-500">BIT</span></span>
                                </div>
                                <div className="text-[10px] font-bold text-white/30 uppercase tracking-widest">oxbit.pro</div>
                            </div>
                            <div className="p-4 grid grid-cols-2 gap-2">
                                <button className="py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl text-[10px] font-black uppercase transition-all">Download</button>
                                <button className="py-3 bg-sky-500 hover:bg-sky-600 text-white rounded-xl text-[10px] font-black uppercase transition-all">Share Now</button>
                            </div>
                        </div>
                    </div>
                );
            };

            if (btcPrice === 0) return (
                <div className="h-screen w-full flex flex-col items-center justify-center bg-white dark:bg-slate-950">
                    <div className="w-12 h-12 border-4 border-sky-500/20 border-t-sky-500 rounded-full animate-spin mb-6"></div>
                    <div className="text-sky-500 font-black text-[10px] tracking-[0.3em] uppercase animate-pulse">Initializing OXBIT Engine</div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col">
                    {shareModal && <ShareCard pos={shareModal} onClose={() => setShareModal(null)} />}
                    
                    {/* Header */}
                    <header className="h-14 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl flex items-center justify-between px-4 md:px-6 sticky top-0 z-[100]">
                        <div className="flex items-center gap-6">
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 bg-sky-500 rounded-xl flex items-center justify-center shadow-lg shadow-sky-500/20">
                                    <i data-lucide="activity" className="w-5 h-5 text-white"></i>
                                </div>
                                <span className="font-black text-lg tracking-tighter">OX<span className="text-sky-500">BIT</span></span>
                            </div>
                            <nav className="hidden lg:flex gap-6 text-[11px] font-black uppercase text-slate-400">
                                <a href="#" className="text-sky-500">Trade</a>
                                <a href="#" className="hover:text-slate-900 dark:hover:text-white">Markets</a>
                                <a href="#" className="hover:text-slate-900 dark:hover:text-white">Earn</a>
                            </nav>
                        </div>
                        <div className="flex items-center gap-3">
                            <button onClick={() => setIsDark(!isDark)} className="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500">
                                <i data-lucide={isDark ? "sun" : "moon"} className="w-4 h-4"></i>
                            </button>
                            <button 
                                onClick={() => setWalletConnected(!walletConnected)}
                                className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${walletConnected ? 'bg-sky-500/10 text-sky-500 border border-sky-500/20' : 'bg-sky-500 text-white shadow-lg shadow-sky-500/30 active:scale-95'}`}
                            >
                                {walletConnected ? '0x71...4f2' : 'Connect Wallet'}
                            </button>
                        </div>
                    </header>

                    {/* Market Ticker */}
                    <div className="hidden md:flex h-10 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-6 items-center gap-8 overflow-x-auto no-scrollbar">
                        <div className="flex items-center gap-2 min-w-fit">
                            <span className="text-xs font-black">BTC/USDT</span>
                            <span className={`font-mono text-xs font-bold ${tickerData.p >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>
                                ${btcPrice.toLocaleString(undefined, { minimumFractionDigits: 1 })}
                            </span>
                        </div>
                        <div className="flex gap-6 text-[10px] font-bold text-slate-400 uppercase">
                            <div className="flex flex-col"><span className="text-[8px] opacity-50">24h Change</span><span className={tickerData.p >= 0 ? 'text-emerald-500' : 'text-rose-500'}>{tickerData.p.toFixed(2)}%</span></div>
                            <div className="flex flex-col"><span className="text-[8px] opacity-50">24h High</span><span className="text-slate-600 dark:text-slate-300">${tickerData.h.toLocaleString()}</span></div>
                            <div className="flex flex-col"><span className="text-[8px] opacity-50">24h Low</span><span className="text-slate-600 dark:text-slate-300">${tickerData.l.toLocaleString()}</span></div>
                        </div>
                    </div>

                    {/* Main Layout */}
                    <main className="flex-1 grid grid-cols-12 gap-1 p-1 md:p-4 max-w-[1800px] mx-auto w-full pb-24 md:pb-4">
                        
                        {/* Center: Chart & Positions */}
                        <div className={`col-span-12 lg:col-span-9 space-y-4 ${mobileTab !== 'trade' ? 'hidden md:block' : ''}`}>
                            <div className="chart-container rounded-3xl overflow-hidden border border-slate-200 dark:border-slate-800 shadow-sm relative">
                                <iframe 
                                    key={isDark}
                                    src={`https://www.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=1&theme=${isDark ? 'dark' : 'light'}&style=1&timezone=Etc%2FUTC&locale=en`}
                                    className="w-full h-full border-none"
                                />
                                
                                {/* Live Position Overlays */}
                                {positions.map(pos => {
                                    const { liq } = getPnL(pos);
                                    return (
                                        <React.Fragment key={pos.id}>
                                            <div className="absolute left-0 right-0 z-20 pointer-events-none flex items-center price-line-anim" style={{ top: getPriceY(pos.entry) }}>
                                                <div className={`flex-1 border-t border-dashed ${pos.side === 'long' ? 'border-sky-500' : 'border-orange-500'}`}></div>
                                                <div className={`px-2 py-1 rounded text-[9px] font-black text-white mr-[60px] ${pos.side === 'long' ? 'bg-sky-500' : 'bg-orange-500'}`}>
                                                    {pos.side.toUpperCase()} @ ${pos.entry.toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="absolute left-0 right-0 z-10 pointer-events-none flex items-center price-line-anim" style={{ top: getPriceY(liq) }}>
                                                <div className="flex-1 border-t border-rose-500/30"></div>
                                                <div className="px-2 py-1 rounded text-[9px] font-black text-white bg-rose-600 mr-[60px]">
                                                    LIQ @ ${liq.toLocaleString(undefined, { maximumFractionDigits: 1 })}
                                                </div>
                                            </div>
                                        </React.Fragment>
                                    );
                                })}
                            </div>

                            {/* Position Table */}
                            <div className="bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 overflow-hidden">
                                <div className="px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                                    <span className="text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                                        <i data-lucide="layers" className="w-3.5 h-3.5 text-sky-500"></i> Open Positions ({positions.length})
                                    </span>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-[11px] text-left">
                                        <thead className="text-slate-400 font-black uppercase border-b border-slate-50 dark:border-slate-800">
                                            <tr>
                                                <th className="px-6 py-4">Market</th>
                                                <th className="px-6 py-4">Size</th>
                                                <th className="px-6 py-4">Entry / Liq.</th>
                                                <th className="px-6 py-4">PnL (ROE)</th>
                                                <th className="px-6 py-4 text-right">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody className="font-bold">
                                            {positions.map(pos => {
                                                const { pnl, roe, liq } = getPnL(pos);
                                                return (
                                                    <tr key={pos.id} className="border-b border-slate-50 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <div className="flex flex-col">
                                                                <span className={pos.side === 'long' ? 'text-emerald-500' : 'text-rose-500'}>{pos.symbol} {pos.side.toUpperCase()}</span>
                                                                <span className="text-[9px] opacity-50">{pos.leverage}x Isolated</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 font-mono">{(pos.size).toFixed(4)} BTC</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex flex-col font-mono">
                                                                <span className="text-slate-600 dark:text-slate-300">${pos.entry.toLocaleString()}</span>
                                                                <span className="text-[9px] text-rose-500 opacity-80">${liq.toLocaleString(undefined, { maximumFractionDigits: 1 })}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className={`flex flex-col ${pnl >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>
                                                                <span>{pnl >= 0 ? '+' : ''}{pnl.toFixed(2)} USDT</span>
                                                                <span className="text-[9px] font-black">{roe.toFixed(2)}%</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-right">
                                                            <div className="flex items-center justify-end gap-2">
                                                                <button onClick={() => setShareModal(pos)} className="w-8 h-8 flex items-center justify-center bg-sky-500/10 text-sky-500 rounded-lg hover:bg-sky-500 hover:text-white transition-all">
                                                                    <i data-lucide="share-2" className="w-3.5 h-3.5"></i>
                                                                </button>
                                                                <button onClick={() => closePos(pos.id)} className="px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-rose-500 hover:text-white transition-all text-[9px] font-black uppercase">Close</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                            {positions.length === 0 && (
                                                <tr>
                                                    <td colSpan="5" className="py-20 text-center text-slate-300 dark:text-slate-600 font-black uppercase text-[10px] tracking-widest">No Active Trading</td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        {/* Right: Order Entry */}
                        <aside className={`col-span-12 lg:col-span-3 space-y-4 ${mobileTab === 'trade' ? '' : 'hidden md:block'}`}>
                            <div className="bg-white dark:bg-slate-900 rounded-3xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm">
                                <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-2xl mb-6">
                                    <button onClick={() => setActiveSide('long')} className={`flex-1 py-3 rounded-xl font-black text-[11px] uppercase transition-all ${activeSide === 'long' ? 'bg-sky-500 text-white shadow-lg shadow-sky-500/20' : 'text-slate-400'}`}>Long</button>
                                    <button onClick={() => setActiveSide('short')} className={`flex-1 py-3 rounded-xl font-black text-[11px] uppercase transition-all ${activeSide === 'short' ? 'bg-rose-500 text-white shadow-lg shadow-rose-500/20' : 'text-slate-400'}`}>Short</button>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <div className="flex justify-between text-[10px] font-black mb-3 text-slate-400 uppercase">Leverage <span className="text-sky-500">{leverage}x</span></div>
                                        <input type="range" min="1" max="100" value={leverage} onChange={(e) => setLeverage(e.target.value)} className="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full appearance-none outline-none" />
                                        <div className="flex justify-between mt-2 text-[8px] font-black text-slate-300"><span>1x</span><span>100x</span></div>
                                    </div>

                                    <div className="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-700">
                                        <div className="flex justify-between text-[9px] font-black text-slate-400 uppercase mb-2"><span>Order Size</span><span>Avbl: 15,200.00</span></div>
                                        <div className="flex items-center gap-2">
                                            <input type="number" value={orderAmount} onChange={(e) => setOrderAmount(e.target.value)} placeholder="0.00" className="bg-transparent text-2xl font-black outline-none w-full dark:text-white" />
                                            <span className="text-xs font-black text-slate-300">USDT</span>
                                        </div>
                                    </div>

                                    <div className="px-1 space-y-2 text-[10px] font-bold text-slate-400 uppercase">
                                        <div className="flex justify-between"><span>Est. Liq Price</span><span className="text-rose-500 font-mono">${(activeSide === 'long' ? btcPrice * (1 - 0.95/leverage) : btcPrice * (1 + 0.95/leverage)).toLocaleString(undefined, { maximumFractionDigits: 1 })}</span></div>
                                        <div className="flex justify-between"><span>Fee (0.04%)</span><span className="text-slate-600 dark:text-slate-300">{(parseFloat(orderAmount || 0) * 0.0004).toFixed(2)} USDT</span></div>
                                    </div>

                                    <button 
                                        onClick={handleTrade}
                                        className={`w-full py-4 rounded-2xl font-black text-[11px] uppercase text-white shadow-xl transition-all active:scale-95 ${activeSide === 'long' ? 'bg-sky-500 shadow-sky-500/20' : 'bg-rose-500 shadow-rose-500/20'}`}
                                    >
                                        Open {activeSide}
                                    </button>
                                </div>
                            </div>
                            
                            {/* Simple Orderbook */}
                            <div className="bg-white dark:bg-slate-900 rounded-3xl p-5 border border-slate-200 dark:border-slate-800">
                                <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Live Orderbook</div>
                                <div className="space-y-1 font-mono text-[10px]">
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className="flex justify-between text-rose-400 opacity-60"><span>${(btcPrice + (5-i)*2.5).toLocaleString()}</span><span>{(Math.random()*0.5).toFixed(3)}</span></div>
                                    ))}
                                    <div className="py-2 text-center text-sky-500 font-black border-y border-slate-100 dark:border-slate-800 my-2">${btcPrice.toLocaleString()}</div>
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className="flex justify-between text-emerald-500 opacity-60"><span>${(btcPrice - (i+1)*2.5).toLocaleString()}</span><span>{(Math.random()*0.5).toFixed(3)}</span></div>
                                    ))}
                                </div>
                            </div>
                        </aside>
                    </main>

                    {/* Mobile Tab Bar */}
                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 grid grid-cols-4 py-3 z-[150] px-2 rounded-t-[32px] shadow-[0_-10px_40px_rgba(0,0,0,0.1)]">
                        <NavItem id="trade" icon="trending-up" label="Trade" />
                        <NavItem id="markets" icon="bar-chart-3" label="Market" />
                        <NavItem id="assets" icon="wallet" label="Assets" />
                        <NavItem id="more" icon="menu" label="More" />
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
