

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‰´íƒ±í¬26 - ì•„ë ˆë‚˜ ë§¤ì¹­ ë° ì¡°ì‘ ì—…ë°ì´íŠ¸</title>
    <style>
        :root {
            --nf-blue: #00d2ff;
            --nf-purple: #9d50bb;
            --nf-magenta: #ff00ff;
            --nf-bg: #02050a;
            --nf-panel-bg: rgba(10, 25, 50, 0.85);
            --nf-border: rgba(0, 210, 255, 0.4);
            --nf-red: #ff3333;
            --nf-green: #00ff88;
            --rank-ss: linear-gradient(135deg, #fff200, #ff9d00);
            --rank-s: linear-gradient(135deg, #e0e0e0, #88aacc);
            --rank-a: linear-gradient(135deg, #ff7e5f, #feb47b);
            --rank-b: linear-gradient(135deg, #4facfe, #00f2fe);
            --rank-common: linear-gradient(135deg, #8b4513, #555);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--nf-bg);
            color: #ffffff;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(157, 80, 187, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 210, 255, 0.15) 0%, transparent 40%);
            overflow: hidden;
            user-select: none;
            height: 100vh;
            width: 100vw;
        }

        header {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: rgba(2, 5, 10, 0.9);
            border-bottom: 1px solid var(--nf-border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box; z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: clamp(18px, 4vw, 26px); font-weight: 900; color: #fff;
            text-shadow: 0 0 15px var(--nf-blue); letter-spacing: 3px;
            font-style: italic;
        }

        .nav-tabs { display: flex; gap: clamp(10px, 2vw, 20px); }

        .nav-item {
            cursor: pointer; font-size: 13px; font-weight: bold; color: #88aacc;
            transition: 0.3s; padding: 10px 0; border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .nav-item:hover, .nav-item.active {
            color: var(--nf-blue); border-bottom: 2px solid var(--nf-blue);
        }

        .container {
            width: 100%; max-width: 1600px; margin: 70px auto 0;
            display: grid; 
            grid-template-columns: 340px 1fr 300px; 
            gap: 15px; padding: 0 15px;
            height: calc(100vh - 80px);
            box-sizing: border-box;
        }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 320px 1fr; }
            .right-col { display: none; }
        }
        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
            .left-col { display: none; }
        }

        .panel {
            background: var(--nf-panel-bg);
            border: 1px solid var(--nf-border);
            border-radius: 8px; padding: clamp(10px, 2vw, 20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            font-size: 12px; font-weight: bold; color: var(--nf-blue);
            margin-bottom: 12px; border-left: 3px solid var(--nf-blue); padding-left: 10px;
            text-transform: uppercase; letter-spacing: 1px;
            flex-shrink: 0;
        }

        .profile-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,210,255,0.05));
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 15px;
        }

        .profile-main {
            display: flex; gap: 15px; align-items: center; margin-bottom: 15px;
        }

        .profile-avatar {
            width: 60px; height: 60px; background: #000; border: 2px solid var(--nf-blue);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 30px; box-shadow: 0 0 15px rgba(0,210,255,0.3);
        }

        .profile-info { flex: 1; }
        .profile-name { font-size: 16px; font-weight: 900; color: #fff; margin-bottom: 4px; }
        
        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }
        .stat-item {
            background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .stat-label { font-size: 9px; color: #88aacc; text-transform: uppercase; margin-bottom: 2px; }
        .stat-value { font-size: 13px; font-weight: bold; color: var(--nf-blue); font-family: monospace; }

        .btn-main {
            background: linear-gradient(135deg, var(--nf-blue), var(--nf-magenta));
            color: #fff; padding: 12px; font-size: 14px; font-weight: 900;
            border-radius: 8px; cursor: pointer; text-align: center;
            margin-bottom: 15px; border: none; transition: 0.3s;
            flex-shrink: 0;
        }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(157, 80, 187, 0.6); }

        /* ê³„ê¸‰ì¥ ìŠ¤íƒ€ì¼ */
        .insignia {
            width: 26px; height: 26px; display: flex; align-items: center; justify-content: center;
            border-radius: 4px; font-weight: bold; font-size: 11px; color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8); flex-shrink: 0;
        }
        .insignia-ss { background: var(--rank-ss); box-shadow: 0 0 8px #fff200; border: 1px solid #fff; }
        .insignia-s { background: var(--rank-s); box-shadow: 0 0 6px #88aacc; border: 1px solid #fff; }
        .insignia-a { background: var(--rank-a); border: 1px solid rgba(255,255,255,0.3); }
        .insignia-b { background: var(--rank-b); border: 1px solid rgba(255,255,255,0.3); }
        .insignia-c { background: var(--rank-common); border: 1px solid rgba(255,255,255,0.2); }

        .ranking-tools {
            display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;
        }
        .search-box {
            position: relative; width: 100%;
        }
        .search-input {
            width: 100%; background: rgba(0,0,0,0.4); border: 1px solid var(--nf-border);
            border-radius: 6px; padding: 10px 12px 10px 35px; color: #fff; font-size: 13px;
            box-sizing: border-box; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--nf-magenta); box-shadow: 0 0 10px rgba(255,0,255,0.2); }
        .search-icon {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
            color: var(--nf-blue); font-size: 14px;
        }

        .ranking-list-container {
            display: flex; flex-direction: column; height: 100%; overflow: hidden;
        }
        
        .ranking-header {
            display: flex; align-items: center; background: rgba(0, 210, 255, 0.15);
            border-radius: 6px; padding: 12px 15px; margin-bottom: 8px;
            font-size: 11px; font-weight: bold; color: var(--nf-blue);
            text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--nf-border);
        }

        .ranking-list { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; flex: 1; padding-right: 5px; }
        
        .ranking-item {
            display: flex; align-items: center; background: rgba(255,255,255,0.03);
            border-radius: 6px; padding: 10px 15px; border: 1px solid rgba(255,255,255,0.03);
            transition: 0.2s;
        }
        .ranking-item:hover { background: rgba(255,255,255,0.06); transform: translateX(5px); }
        .ranking-item.me { background: rgba(0, 210, 255, 0.1); border-color: var(--nf-blue); box-shadow: inset 0 0 10px rgba(0,210,255,0.1); }
        
        .col-rank { width: 40px; font-weight: 900; font-family: monospace; color: #88aacc; font-size: 14px; flex-shrink: 0; }
        .col-insignia { width: 50px; display: flex; justify-content: center; flex-shrink: 0; }
        .col-name { flex: 1; font-weight: bold; margin-left: 10px; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .col-winrate { width: 100px; font-size: 12px; color: #88aacc; text-align: center; font-family: monospace; flex-shrink: 0; }
        .col-score { width: 120px; font-family: monospace; color: var(--nf-blue); font-weight: bold; text-align: right; flex-shrink: 0; font-size: 15px; }

        .pagination {
            display: flex; justify-content: center; align-items: center; gap: 15px; padding: 15px 0;
            background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05);
        }
        .page-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;
            transition: 0.2s;
        }
        .page-btn:hover:not(:disabled) { background: var(--nf-blue); border-color: #fff; }
        .page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .page-info { font-size: 12px; color: #88aacc; font-weight: bold; }

        .arena-list { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .arena-item {
            background: rgba(0,210,255,0.05); border: 1px solid var(--nf-blue);
            border-radius: 8px; padding: 20px; cursor: pointer; transition: 0.2s;
            position: relative; overflow: hidden;
        }
        .arena-item:hover { background: rgba(0,210,255,0.15); transform: translateY(-3px); border-color: var(--nf-magenta); }
        .arena-item .match-type { font-size: 18px; font-weight: 900; color: #fff; margin-bottom: 5px; }
        .arena-item .match-desc { font-size: 11px; color: var(--nf-blue); }
        .arena-item .match-btn { margin-top: 15px; font-size: 12px; font-weight: 900; color: var(--nf-blue); border: 1px solid var(--nf-blue); display: inline-block; padding: 4px 12px; border-radius: 4px; }

        #game-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 2000; flex-direction: column;
        }
        #gameCanvas { width: 100%; height: 100%; cursor: crosshair; touch-action: none; }
        .game-ui { position: absolute; top: 20px; left: 20px; z-index: 2001; pointer-events: none; }
        .hp-bar-outer { width: 250px; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2); }
        .hp-bar-inner { height: 100%; background: linear-gradient(90deg, #ff3333, #ff6666); width: 100%; transition: 0.2s; }
        
        .result-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 3000; flex-direction: column; align-items: center; justify-content: center;
        }
        .result-content { text-align: center; }
        .result-title { font-size: 48px; font-weight: 900; margin-bottom: 20px; }
        .victory { color: var(--nf-green); text-shadow: 0 0 20px var(--nf-green); }
        .defeat { color: var(--nf-red); text-shadow: 0 0 20px var(--nf-red); }

        .tab-content { display: none; height: 100%; }
        .tab-content.active { display: block; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--nf-border); border-radius: 10px; }
    </style>
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const Player = {
            uid: null,
            nickname: "ì‹ ì…_íŒŒì¼ëŸ¿", 
            score: 0, 
            rank: 0, 
            wins: 0, 
            losses: 0,
            get winRate() { let t = this.wins + this.losses; return t === 0 ? "0.0" : ((this.wins / t) * 100).toFixed(1); },
            get insignia() {
                if (this.score >= 50000) return { label: 'SS', class: 'insignia-ss', title: 'Grand Master' };
                if (this.score >= 20000) return { label: 'S', class: 'insignia-s', title: 'Specialist' };
                if (this.score >= 8000) return { label: 'A', class: 'insignia-a', title: 'Elite' };
                if (this.score >= 2000) return { label: 'B', class: 'insignia-b', title: 'Veteran' };
                return { label: 'C', class: 'insignia-c', title: 'Recruit' };
            }
        };
        window.Player = Player;

        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) { console.error("Auth Failed", err); }
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                Player.uid = user.uid;
                await loadPlayerData();
                window.addLog(`[SYSTEM] ì„œë²„ ì¸ì¦ ì™„ë£Œ: ${Player.nickname}`);
                window.refreshProfileUI();
                window.renderRanking();
            }
        });

        async function loadPlayerData() {
            if (!Player.uid) return;
            const userDocRef = doc(db, 'artifacts', appId, 'users', Player.uid, 'profile', 'data');
            const snap = await getDoc(userDocRef);
            if (snap.exists()) {
                const data = snap.data();
                Player.nickname = data.nickname || Player.nickname;
                Player.score = data.score || 0;
                Player.wins = data.wins || 0;
                Player.losses = data.losses || 0;
            } else { await savePlayerData(); }
        }

        async function savePlayerData() {
            if (!Player.uid) return;
            const userDocRef = doc(db, 'artifacts', appId, 'users', Player.uid, 'profile', 'data');
            await setDoc(userDocRef, {
                nickname: Player.nickname,
                score: Player.score,
                wins: Player.wins,
                losses: Player.losses,
                lastUpdated: Date.now()
            }, { merge: true });
        }
        window.savePlayerData = savePlayerData;
        initAuth();
    </script>
</head>
<body>

    <header>
        <div class="logo">NEWTANK26</div>
        <div class="nav-tabs">
            <div id="nav-arena" class="nav-item active" onclick="showTab('arena')">ì•„ë ˆë‚˜</div>
            <div id="nav-rank" class="nav-item" onclick="showTab('rank')">ë­í‚¹</div>
            <div id="nav-patch" class="nav-item" onclick="showTab('patch')">íŒ¨ì¹˜ë…¸íŠ¸</div>
        </div>
        <div style="font-size: 11px; color: var(--nf-blue);" id="server-stats">ì˜¨ë¼ì¸ ìŠ¤í…Œì´í„°ìŠ¤: ì•ˆì •</div>
    </header>

    <div class="container" id="main-ui">
        <!-- Left: Profile -->
        <div class="left-col">
            <div class="panel">
                <div class="panel-header">íŒŒì¼ëŸ¿ ìƒì„¸ í”„ë¡œí•„</div>
                <div class="profile-card">
                    <div class="profile-main">
                        <div class="profile-avatar">ğŸ›¡ï¸</div>
                        <div class="profile-info">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
                                <div id="player-insignia" class="insignia insignia-c">C</div>
                                <div id="player-nickname-display" class="profile-name">...</div>
                            </div>
                            <div id="player-title" style="font-size: 10px; color: var(--nf-magenta); font-weight: bold;">[ ì‹œìŠ¤í…œ ë™ê¸°í™” ì™„ë£Œ ]</div>
                        </div>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-item"><div class="stat-label">ê¸€ë¡œë²Œ ìˆœìœ„</div><div class="stat-value" id="player-rank">#--</div></div>
                        <div class="stat-item"><div class="stat-label">ëˆ„ì  ì ìˆ˜</div><div class="stat-value" id="player-score">0</div></div>
                        <div class="stat-item"><div class="stat-label">ìŠ¹ë¥ </div><div class="stat-value" id="player-winrate">0.0%</div></div>
                        <div class="stat-item"><div class="stat-label">í˜„ ê³„ê¸‰</div><div class="stat-value" id="player-class-text">--</div></div>
                    </div>
                </div>
                <div class="panel-header">ë‹‰ë„¤ì„ ë³€ê²½</div>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="nickname-input" style="flex: 1; background: rgba(0,0,0,0.5); border: 1px solid var(--nf-border); border-radius: 4px; padding: 8px; color: #fff; font-size: 12px;" placeholder="ìƒˆ ë‹‰ë„¤ì„ ì…ë ¥..." maxlength="12">
                    <button class="btn-main" style="margin:0; padding: 5px 12px; font-size: 11px;" onclick="updateNickname()">ë³€ê²½</button>
                </div>
            </div>
        </div>

        <!-- Center: Tab Contents -->
        <div class="center-col">
            <div id="tab-arena" class="tab-content active">
                <div class="panel" style="height: 100%;">
                    <div class="panel-header">ì‹¤ì „ ë§¤ì¹­ ì‹œìŠ¤í…œ</div>
                    <div class="arena-list">
                        <div class="arena-item" onclick="startBattle('1:1')">
                            <div class="match-type">1:1 MATCH</div>
                            <div class="match-desc">ê³ ë…í•œ ì—ì´ìŠ¤ë“¤ì˜ ëŒ€ê²°. ìˆœìˆ˜ ì‹¤ë ¥ì„ ì¦ëª…í•˜ì„¸ìš”.</div>
                            <div class="match-btn">ë§¤ì¹­ ì‹œì‘</div>
                        </div>
                        <div class="arena-item" onclick="startBattle('2:2')">
                            <div class="match-type">2:2 MATCH</div>
                            <div class="match-desc">ë™ë£Œì™€ì˜ ì—°ê³„ê°€ ìŠ¹ë¶€ë¥¼ ê²°ì •ì§“ìŠµë‹ˆë‹¤.</div>
                            <div class="match-btn">ë§¤ì¹­ ì‹œì‘</div>
                        </div>
                        <div class="arena-item" onclick="startBattle('3:3')">
                            <div class="match-type">3:3 MATCH</div>
                            <div class="match-desc">ì „ìˆ ì  ì§„í˜• ìœ ì§€ê°€ í•µì‹¬ì¸ íŒ€ ë°°í‹€ì…ë‹ˆë‹¤.</div>
                            <div class="match-btn">ë§¤ì¹­ ì‹œì‘</div>
                        </div>
                        <div class="arena-item" onclick="startBattle('4:4')">
                            <div class="match-type">4:4 MATCH</div>
                            <div class="match-desc">ëŒ€ê·œëª¨ ì „ë©´ì „. ì••ë„ì ì¸ í™”ë ¥ì„ ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤.</div>
                            <div class="match-btn">ë§¤ì¹­ ì‹œì‘</div>
                        </div>
                    </div>
                    <div style="margin-top: auto; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px dashed var(--nf-blue);">
                        <p style="font-size: 12px; color: var(--nf-blue); font-weight: bold; margin-bottom: 5px;">[ ì¡°ì‘ ê°€ì´ë“œ ]</p>
                        <p style="font-size: 11px; color: #88aacc;">â€¢ ì´ë™: WASD ë˜ëŠ” ë°©í–¥í‚¤<br>â€¢ ì‚¬ê²©: <b>SPACE (ê°•ë ¥ íƒ€ê²©)</b> ë˜ëŠ” ë§ˆìš°ìŠ¤ ì™¼ìª½ í´ë¦­<br>â€¢ ì¡°ì¤€: ë§ˆìš°ìŠ¤ ì»¤ì„œ ìœ„ì¹˜</p>
                    </div>
                </div>
            </div>

            <div id="tab-rank" class="tab-content">
                <div class="panel" style="height: 100%;">
                    <div class="panel-header">ê¸€ë¡œë²Œ ëª…ì˜ˆì˜ ì „ë‹¹</div>
                    <div class="ranking-tools">
                        <div class="search-box">
                            <span class="search-icon">ğŸ”</span>
                            <input type="text" id="rank-search-input" class="search-input" placeholder="íŒŒì¼ëŸ¿ ê²€ìƒ‰..." oninput="handleSearch()">
                        </div>
                    </div>
                    <div class="ranking-list-container">
                        <div class="ranking-header">
                            <div class="col-rank">RANK</div>
                            <div class="col-insignia">CLASS</div>
                            <div class="col-name">PILOT NICKNAME</div>
                            <div class="col-winrate">WIN RATE</div>
                            <div class="col-score">TOTAL SCORE</div>
                        </div>
                        <div id="ranking-container" class="ranking-list"></div>
                        <div class="pagination">
                            <button id="prev-page" class="page-btn" onclick="changePage(-1)">ì´ì „</button>
                            <span id="page-info" class="page-info">1 / 1</span>
                            <button id="next-page" class="page-btn" onclick="changePage(1)">ë‹¤ìŒ</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-patch" class="tab-content">
                <div class="panel" style="height: 100%;">
                    <div class="panel-header">íŒ¨ì¹˜ë…¸íŠ¸</div>
                    <div style="font-size: 12px; color: #88aacc; line-height: 1.8; overflow-y: auto;">
                        <p><b style="color: var(--nf-blue);">[v1.8.0] ì•„ë ˆë‚˜ ë§¤ì¹­ ë° ì¡°ì‘ ì²´ê³„ ê°œí¸</b></p>
                        <p>- <b>ë§¤ì¹­ ì„¸ë¶„í™”</b>: ì•„ë ˆë‚˜ê°€ 1:1, 2:2, 3:3, 4:4 ëª¨ë“œë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <p>- <b>ì¡°ì‘ê° ê°œì„ </b>: ìŠ¤í˜ì´ìŠ¤ë°”(SPACE) í‚¤ë¥¼ ì´ìš©í•œ í¬ê²© ì‹œìŠ¤í…œì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <p>- <b>UI ë¦¬ë„¤ì´ë°</b>: ì—…ë°ì´íŠ¸ ë©”ë‰´ì˜ ëª…ì¹­ì´ 'íŒ¨ì¹˜ë…¸íŠ¸'ë¡œ ì •ì‹ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <hr style="border-color: rgba(255,255,255,0.05); margin: 15px 0;">
                        <p><b style="color: var(--nf-blue);">[v1.7.0] ë¦¬ë”ë³´ë“œ ì‹œê°í™” ê°•í™”</b></p>
                        <p>- ë­í‚¹ íƒ­ì— ê³„ê¸‰ì¥ ì‹œìŠ¤í…œì´ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <p>- ìŠ¹ë¥  ë° ëˆ„ì  ì ìˆ˜ ë¹„êµ ê¸°ëŠ¥ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Logs -->
        <div class="right-col">
            <div class="panel" style="height: 100%;">
                <div class="panel-header">ì‹¤ì‹œê°„ ë³´ì•ˆ í†µì‹ </div>
                <div id="system-logs" style="font-family: monospace; font-size: 10px; color: #557799; flex: 1; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- Game Viewport -->
    <div id="game-overlay">
        <div class="game-ui">
            <div style="font-size: 11px; font-weight: bold; margin-bottom: 5px; color: var(--nf-blue);">HULL INTEGRITY</div>
            <div class="hp-bar-outer"><div id="hp-bar" class="hp-bar-inner"></div></div>
            <div id="game-stats-display" style="font-family: monospace; font-size: 14px; margin-top: 10px; color: var(--nf-magenta);">KILLS: 0 | SCORE: 0</div>
            <div id="match-info-display" style="font-size: 12px; color: #fff; margin-top: 5px; opacity: 0.7;">MATCH TYPE: 1:1</div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- Result -->
    <div id="result-overlay" class="result-overlay">
        <div class="result-content">
            <div id="res-title" class="result-title">MISSION COMPLETE</div>
            <div style="font-size: 18px; margin-bottom: 30px;" id="res-msg">íŒŒì¼ëŸ¿ ë°ì´í„° ë™ê¸°í™” ëŒ€ê¸° ì¤‘...</div>
            <button class="btn-main" style="width: 240px;" onclick="closeGame()">ê¸°ì§€ë¡œ ê·€í™˜</button>
        </div>
    </div>

    <script>
        // --- ë­í‚¹ ë° UI ë°ì´í„° ---
        const MOCK_NICKNAMES = ["ShadowWalker", "Ace_Pilot", "Ghost_Rider", "DarkNight", "DragonSlayer", "Zero_One", "Phantom", "Cyber_X", "Storm_Bringer", "Nova_Core"];
        const ITEMS_PER_PAGE = 15;
        let currentPage = 1;
        let searchQuery = "";
        let globalRankData = [];

        function getInsigniaByScore(score) {
            if (score >= 50000) return { label: 'SS', class: 'insignia-ss' };
            if (score >= 20000) return { label: 'S', class: 'insignia-s' };
            if (score >= 8000) return { label: 'A', class: 'insignia-a' };
            if (score >= 2000) return { label: 'B', class: 'insignia-b' };
            return { label: 'C', class: 'insignia-c' };
        }

        function generateRanks() {
            const list = [];
            for(let i=0; i < 60; i++) {
                const sc = Math.floor(75000 * Math.pow(0.94, i));
                list.push({
                    name: MOCK_NICKNAMES[Math.floor(Math.random()*MOCK_NICKNAMES.length)] + "_" + (i+1),
                    score: sc,
                    winrate: (Math.random() * 30 + 50).toFixed(1)
                });
            }
            return list;
        }
        globalRankData = generateRanks();

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`nav-${tabId}`).classList.add('active');
            if (tabId === 'rank') renderRanking();
        }

        function handleSearch() {
            searchQuery = document.getElementById('rank-search-input').value.toLowerCase();
            currentPage = 1;
            renderRanking();
        }

        function changePage(delta) {
            currentPage += delta;
            renderRanking();
        }

        function renderRanking() {
            const container = document.getElementById('ranking-container');
            if(!container || !window.Player) return;

            let fullList = [...globalRankData, { 
                name: window.Player.nickname, 
                score: window.Player.score, 
                winrate: window.Player.winRate, 
                isMe: true 
            }].sort((a, b) => b.score - a.score);
            
            fullList.forEach((item, idx) => { if(item.isMe) window.Player.rank = idx + 1; item.idx = idx + 1; });

            const filtered = fullList.filter(item => item.name.toLowerCase().includes(searchQuery));
            const totalPages = Math.ceil(filtered.length / ITEMS_PER_PAGE) || 1;
            const pageItems = filtered.slice((currentPage - 1) * ITEMS_PER_PAGE, currentPage * ITEMS_PER_PAGE);

            container.innerHTML = "";
            pageItems.forEach(item => {
                const insData = getInsigniaByScore(item.score);
                const div = document.createElement('div');
                div.className = `ranking-item ${item.isMe ? 'me' : ''}`;
                div.innerHTML = `
                    <div class="col-rank">#${item.idx}</div>
                    <div class="col-insignia"><div class="insignia ${insData.class}">${insData.label}</div></div>
                    <div class="col-name">${item.name}</div>
                    <div class="col-winrate">${item.winrate}%</div>
                    <div class="col-score">${item.score.toLocaleString()}</div>
                `;
                container.appendChild(div);
            });

            document.getElementById('page-info').innerText = `${currentPage} / ${totalPages}`;
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
            refreshProfileUI();
        }

        function refreshProfileUI() {
            if(!window.Player) return;
            document.getElementById('player-nickname-display').innerText = window.Player.nickname;
            document.getElementById('player-score').innerText = window.Player.score.toLocaleString();
            document.getElementById('player-rank').innerText = `#${window.Player.rank || '--'}`;
            document.getElementById('player-winrate').innerText = `${window.Player.winRate}%`;
            const ins = window.Player.insignia;
            const el = document.getElementById('player-insignia');
            if(el) { el.innerText = ins.label; el.className = `insignia ${ins.class}`; }
            const ct = document.getElementById('player-class-text');
            if(ct) ct.innerText = ins.title;
        }
        window.refreshProfileUI = refreshProfileUI;

        async function updateNickname() {
            const v = document.getElementById('nickname-input').value.trim();
            if(v) { 
                window.Player.nickname = v; 
                if(window.savePlayerData) await window.savePlayerData();
                renderRanking();
                addLog(`[SYSTEM] ë‹‰ë„¤ì„ ë³€ê²½ ìŠ¹ì¸: ${v}`);
            }
        }

        function addLog(msg) {
            const b = document.getElementById('system-logs');
            if(!b) return;
            const d = document.createElement('div');
            d.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        }
        window.addLog = addLog;

        // --- ì „íˆ¬ ì—”ì§„ ---
        let gameActive = false;
        let canvas, ctx, animId;
        let keys = {};
        let mouse = { x: 0, y: 0 };
        
        let pTank = { x: 0, y: 0, r: 22, hp: 100, score: 0, kills: 0 };
        let bullets = [];
        let enemies = [];
        let lastShotTime = 0;
        
        window.addEventListener('keydown', e => { 
            keys[e.code] = true; 
            if(e.code === 'Space' && gameActive) {
                e.preventDefault();
                shoot(); 
            }
        });
        window.addEventListener('keyup', e => { keys[e.code] = false; });
        window.addEventListener('mousemove', e => {
            if(!canvas) return;
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        });
        window.addEventListener('mousedown', () => { if(gameActive) shoot(); });

        function shoot() {
            const now = Date.now();
            if(now - lastShotTime < 200) return; // ì—°ì‚¬ ì œí•œ
            lastShotTime = now;

            const angle = Math.atan2(mouse.y - pTank.y, mouse.x - pTank.x);
            bullets.push({
                x: pTank.x + Math.cos(angle) * 30,
                y: pTank.y + Math.sin(angle) * 30,
                vx: Math.cos(angle) * 14,
                vy: Math.sin(angle) * 14,
                life: 80
            });
        }

        function spawnEnemy() {
            if(enemies.length > 20) return;
            let x, y;
            if(Math.random() > 0.5) {
                x = Math.random() > 0.5 ? -50 : canvas.width + 50;
                y = Math.random() * canvas.height;
            } else {
                x = Math.random() * canvas.width;
                y = Math.random() > 0.5 ? -50 : canvas.height + 50;
            }
            enemies.push({ x, y, r: 20, hp: 40, speed: 1.2 + Math.random() * 1.5 });
        }

        function startBattle(matchType) {
            document.getElementById('game-overlay').style.display = 'flex';
            document.getElementById('match-info-display').innerText = `MATCH TYPE: ${matchType}`;
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            resizeCanvas();
            gameActive = true;
            pTank = { x: canvas.width/2, y: canvas.height/2, r: 22, hp: 100, score: 0, kills: 0 };
            bullets = []; enemies = [];
            
            addLog(`[COMBAT] ${matchType} ë§¤ì¹­ ì „ì¥ ì§„ì….`);
            updateHPBar();
            requestAnimationFrame(gameLoop);
        }

        function resizeCanvas() {
            if(!canvas) return;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if(pTank) {
                pTank.x = canvas.width/2;
                pTank.y = canvas.height/2;
            }
        }

        function gameLoop() {
            if(!gameActive) return;
            update();
            draw();
            animId = requestAnimationFrame(gameLoop);
        }

        function update() {
            const spd = 6;
            if(keys['KeyW'] || keys['ArrowUp']) pTank.y -= spd;
            if(keys['KeyS'] || keys['ArrowDown']) pTank.y += spd;
            if(keys['KeyA'] || keys['ArrowLeft']) pTank.x -= spd;
            if(keys['KeyD'] || keys['ArrowRight']) pTank.x += spd;

            pTank.x = Math.max(pTank.r, Math.min(canvas.width - pTank.r, pTank.x));
            pTank.y = Math.max(pTank.r, Math.min(canvas.height - pTank.r, pTank.y));

            if(Math.random() < 0.05) spawnEnemy();

            bullets.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy; b.life--;
                if(b.life <= 0) bullets.splice(bi, 1);
            });

            enemies.forEach((e, ei) => {
                const angle = Math.atan2(pTank.y - e.y, pTank.x - e.x);
                e.x += Math.cos(angle) * e.speed;
                e.y += Math.sin(angle) * e.speed;

                bullets.forEach((b, bi) => {
                    if(Math.hypot(e.x - b.x, e.y - b.y) < e.r + 5) {
                        e.hp -= 20;
                        bullets.splice(bi, 1);
                        if(e.hp <= 0) {
                            enemies.splice(ei, 1);
                            pTank.kills++;
                            pTank.score += 150;
                            document.getElementById('game-stats-display').innerText = `KILLS: ${pTank.kills} | SCORE: ${pTank.score}`;
                        }
                    }
                });

                if(Math.hypot(pTank.x - e.x, pTank.y - e.y) < pTank.r + e.r) {
                    pTank.hp -= 0.5;
                    updateHPBar();
                    if(pTank.hp <= 0) endBattle();
                }
            });
        }

        function draw() {
            ctx.fillStyle = '#02050a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid
            ctx.strokeStyle = 'rgba(0, 210, 255, 0.05)';
            for(let i=0; i<canvas.width; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
            for(let i=0; i<canvas.height; i+=50) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); }

            // Enemies
            enemies.forEach(e => {
                ctx.save();
                ctx.translate(e.x, e.y);
                ctx.rotate(Math.atan2(pTank.y - e.y, pTank.x - e.x));
                ctx.fillStyle = '#ff3333'; ctx.fillRect(-15, -15, 30, 30);
                ctx.fillStyle = '#800'; ctx.fillRect(5, -3, 15, 6);
                ctx.restore();
            });

            // Bullets
            ctx.fillStyle = '#fff200';
            bullets.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill(); });

            // Player
            ctx.save();
            ctx.translate(pTank.x, pTank.y);
            ctx.rotate(Math.atan2(mouse.y - pTank.y, mouse.x - pTank.x));
            ctx.fillStyle = '#00d2ff'; ctx.fillRect(-20, -20, 40, 40);
            ctx.fillStyle = '#fff'; ctx.fillRect(5, -5, 25, 10);
            ctx.restore();
        }

        function updateHPBar() {
            document.getElementById('hp-bar').style.width = Math.max(0, pTank.hp) + '%';
        }

        function endBattle() {
            gameActive = false;
            cancelAnimationFrame(animId);
            document.getElementById('result-overlay').style.display = 'flex';
            
            const title = document.getElementById('res-title');
            const msg = document.getElementById('res-msg');
            
            title.innerText = "MISSION FAILED";
            title.className = "result-title defeat";
            msg.innerText = `ê¸°ì²´ ëŒ€íŒŒ. í™•ë³´í•œ ë°ì´í„° ì ìˆ˜: ${pTank.score}`;
            
            window.Player.score += pTank.score;
            window.Player.losses += 1;
            if(window.savePlayerData) window.savePlayerData();
            renderRanking();
        }

        function closeGame() {
            document.getElementById('game-overlay').style.display = 'none';
            document.getElementById('result-overlay').style.display = 'none';
        }
        window.closeGame = closeGame;
        window.addEventListener('resize', resizeCanvas);
        window.onload = () => { renderRanking(); };
    </script>
</body>
</html>
