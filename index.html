<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OXBIT | Professional Crypto DEX</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
    </style>
</head>
<body class="bg-white text-slate-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        // Lucide 아이콘 비구조화 할당 (CDN 방식 대응)
        const { 
            ArrowUpRight, ArrowDownRight, Wallet, Activity, Settings, 
            ChevronDown, Menu, X, Lock, Zap, ShieldCheck, Globe, 
            TrendingUp, BarChart3, Share2, Download, Copy 
        } = lucide;

        const App = () => {
            const [leverage, setLeverage] = useState(10);
            const [isWalletConnected, setIsWalletConnected] = useState(false);
            const [activeTab, setActiveTab] = useState('long');
            const [btcPrice, setBtcPrice] = useState(0);
            const [priceChange, setPriceChange] = useState(0);
            const [high24h, setHigh24h] = useState(0);
            const [low24h, setLow24h] = useState(0);
            const [volume24h, setVolume24h] = useState(0);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [showPnlCard, setShowPnlCard] = useState(false);

            const entryPrice = 64100.00;
            const positionSide = 'long';

            useEffect(() => {
                let ws;
                const connectWS = () => {
                    ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
                    ws.onopen = () => setConnectionStatus('connected');
                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        setBtcPrice(parseFloat(data.c));
                        setPriceChange(parseFloat(data.P));
                        setHigh24h(parseFloat(data.h));
                        setLow24h(parseFloat(data.l));
                        setVolume24h(parseFloat(data.q));
                    };
                    ws.onclose = () => {
                        setConnectionStatus('disconnected');
                        setTimeout(connectWS, 3000);
                    };
                };
                connectWS();
                return () => ws && ws.close();
            }, []);

            const pnlData = useMemo(() => {
                if (!btcPrice) return { uPnl: 0, roe: 0 };
                const diff = btcPrice - entryPrice;
                const uPnl = positionSide === 'long' ? diff * 0.5 : -diff * 0.5;
                const roe = (uPnl / (entryPrice * 0.5 / 10)) * 100;
                return { uPnl, roe };
            }, [btcPrice]);

            const calculateLiqPrice = (price, lev, side) => {
                if (!price || price <= 0) return 0;
                return side === 'long' ? price * (1 - 1 / lev) : price * (1 + 1 / lev);
            };

            const currentLiqPrice = useMemo(() => calculateLiqPrice(entryPrice, 10, positionSide), []);
            const estimatedLiqPrice = useMemo(() => calculateLiqPrice(btcPrice, leverage, activeTab), [btcPrice, leverage, activeTab]);

            const orderBookData = useMemo(() => {
                if (btcPrice === 0) return { asks: [], bids: [] };
                const asks = [], bids = [];
                for (let i = 5; i >= 1; i--) asks.push({ price: btcPrice + (i * 0.5), amount: (Math.random() * 0.8 + 0.1).toFixed(3) });
                for (let i = 1; i <= 5; i++) bids.push({ price: btcPrice - (i * 0.5), amount: (Math.random() * 1.2 + 0.2).toFixed(3) });
                return { asks, bids };
            }, [btcPrice]);

            const OxbitLogo = () => (
                <div className="flex items-center gap-2">
                    <div className="grid grid-cols-3 gap-0.5 p-1 bg-slate-900 rounded-lg shadow-lg shadow-sky-200">
                        {[...Array(9)].map((_, i) => (
                            <div key={i} className={`w-2 h-2 rounded-sm ${i === 4 ? 'bg-white shadow-[0_0_8px_#38bdf8]' : 'bg-sky-500 opacity-60'}`}></div>
                        ))}
                    </div>
                    <span className="text-2xl font-black tracking-tighter text-slate-900">
                        OX<span className="text-sky-500">BIT</span>
                    </span>
                </div>
            );

            if (btcPrice === 0) return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-white">
                    <div className="animate-spin mb-4 text-sky-500"><i data-lucide="activity" style={{width: '48px', height: '48px'}}></i></div>
                    <p className="font-black text-slate-400 animate-pulse tracking-widest uppercase">Connecting to Binance Cloud...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-16">
                    {/* PnL Card Modal */}
                    {showPnlCard && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-[40px] overflow-hidden shadow-2xl max-w-sm w-full relative">
                                <button onClick={() => setShowPnlCard(false)} className="absolute top-6 right-6 p-2 bg-white/20 hover:bg-white/40 rounded-full text-slate-900 z-10 transition-colors">
                                    <i data-lucide="x"></i>
                                </button>
                                <div className="p-8 bg-slate-900 text-white relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-sky-500/20 blur-[100px] -mr-32 -mt-32"></div>
                                    <div className="relative z-10">
                                        <div className="flex justify-between items-start mb-12"><OxbitLogo /><div className="text-right text-[10px] font-black"><div className="text-sky-400 uppercase tracking-widest">Binance Live</div><div className="text-slate-400">BTCUSDT Perpetual</div></div></div>
                                        <div className="mb-10">
                                            <div className={`text-6xl font-black tracking-tighter ${pnlData.roe >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>{pnlData.roe >= 0 ? '+' : ''}{pnlData.roe.toFixed(2)}%</div>
                                            <div className="text-xs font-bold text-slate-400 mt-2 flex items-center gap-2"><span className="px-2 py-0.5 bg-slate-800 rounded text-sky-400">10x</span><span>Isolated Long</span></div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-8 border-t border-white/10 pt-8">
                                            <div><div className="text-[10px] font-black text-slate-500 uppercase mb-1">진입 가격</div><div className="font-mono font-bold">${entryPrice.toLocaleString()}</div></div>
                                            <div className="text-right"><div className="text-[10px] font-black text-slate-500 uppercase mb-1">현재 가격</div><div className="font-mono font-bold text-sky-400">${btcPrice.toLocaleString()}</div></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="p-6 flex gap-3">
                                    <button className="flex-1 py-4 bg-sky-500 text-white rounded-2xl font-black text-sm flex items-center justify-center gap-2 hover:bg-sky-600 transition-all"><i data-lucide="download" style={{width: '16px'}}></i> 이미지 저장</button>
                                    <button className="p-4 bg-slate-100 text-slate-600 rounded-2xl hover:bg-slate-200"><i data-lucide="copy"></i></button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Top Ticker Bar */}
                    <div className="bg-slate-900 text-white text-[11px] py-2 px-6 border-b border-sky-900/30 flex items-center overflow-hidden">
                        <div className="flex gap-8 items-center whitespace-nowrap">
                            <div className="flex gap-2 items-center">
                                <span className="font-bold text-sky-400">BTC/USDT</span>
                                <span className="font-mono text-white">${btcPrice.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>
                                <span className={priceChange >= 0 ? 'text-emerald-400' : 'text-rose-400'}>{priceChange >= 0 ? '+' : ''}{priceChange.toFixed(2)}%</span>
                            </div>
                            <div className="flex gap-4 items-center opacity-60 border-l border-white/10 pl-8 font-mono">
                                <span>24h High: ${high24h.toLocaleString()}</span>
                                <span>24h Low: ${low24h.toLocaleString()}</span>
                            </div>
                        </div>
                        <div className="ml-auto hidden lg:flex items-center gap-4 text-sky-400/80 uppercase font-bold tracking-tighter">
                             {connectionStatus === 'connected' ? '● Binance Live Feed' : 'Connecting...'}
                        </div>
                    </div>

                    {/* Nav */}
                    <nav className="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-sky-50 px-6 h-16 flex justify-between items-center">
                        <div className="flex items-center gap-10">
                            <OxbitLogo />
                            <div className="hidden lg:flex items-center space-x-8 text-sm font-bold text-slate-500">
                                <button className="text-sky-600 bg-sky-50 px-3 py-1.5 rounded-xl border border-sky-100 flex items-center gap-1">거래소 <i data-lucide="chevron-down" style={{width:'14px'}}></i></button>
                                <button className="hover:text-sky-500 transition-colors">파생상품</button>
                                <button className="hover:text-sky-500 transition-colors">자산운용</button>
                            </div>
                        </div>
                        <button onClick={() => setIsWalletConnected(!isWalletConnected)} className={`px-6 py-2.5 rounded-2xl font-black text-sm transition-all flex items-center gap-2 shadow-xl ${isWalletConnected ? 'bg-slate-100 text-slate-600' : 'bg-sky-500 text-white'}`}>
                            <i data-lucide="wallet" style={{width:'16px'}}></i>
                            {isWalletConnected ? '0x71...4f2' : '지갑 연결'}
                        </button>
                    </nav>

                    <main className="max-w-[1800px] mx-auto px-6 py-6 grid grid-cols-12 gap-6">
                        <div className="col-span-12 lg:col-span-9 space-y-6">
                            <div className="bg-white p-6 rounded-[32px] border border-sky-100 shadow-sm flex items-center justify-between overflow-hidden relative group">
                                <div className="absolute top-0 left-0 w-2 h-full bg-sky-500"></div>
                                <div className="flex items-center gap-6">
                                    <div className="w-14 h-14 bg-slate-900 rounded-[20px] flex items-center justify-center text-white font-black shadow-lg shadow-sky-100">BTC</div>
                                    <div><h2 className="text-2xl font-black text-slate-900 tracking-tighter">BTC-USDT 무기한</h2><div className="flex items-center gap-2 mt-1"><span className="text-[10px] font-black bg-sky-500 text-white px-2 py-0.5 rounded-full">실시간 연동됨</span></div></div>
                                </div>
                                <div className="text-right">
                                    <div className="text-[11px] font-bold text-slate-400 uppercase mb-1">시장가</div>
                                    <div className="text-2xl font-mono font-black text-sky-500 tracking-tighter">${btcPrice.toLocaleString(undefined, { minimumFractionDigits: 2 })}</div>
                                </div>
                            </div>

                            {/* Chart (Seoul Time) */}
                            <div className="bg-white rounded-[40px] border border-sky-100 shadow-xl overflow-hidden aspect-[21/10] relative">
                                <iframe id="tradingview_btc_usdt" title="Binance Chart" src={`https://www.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=1&hidesidetoolbar=0&symboledit=1&saveimage=1&toolbarbg=ffffff&theme=light&style=1&timezone=Asia%2FSeoul&withdateranges=1&showpopupbutton=1&locale=kr`} width="100%" height="100%" frameBorder="0" scrolling="no" className="absolute inset-0"></iframe>
                            </div>

                            {/* Position Table */}
                            <div className="bg-white rounded-[32px] border border-sky-100 shadow-sm overflow-hidden">
                                <div className="flex bg-slate-50 border-b border-sky-50"><button className="px-8 py-4 font-black text-sm text-sky-600 bg-white border-r border-sky-50">포지션 (1)</button></div>
                                <div className="p-8 overflow-x-auto">
                                    <table className="w-full text-left">
                                        <thead><tr className="text-[10px] font-black text-slate-400 uppercase tracking-widest"><th className="pb-6">자산/사이드</th><th className="pb-6 text-right">수량</th><th className="pb-6 text-right">진입가</th><th className="pb-6 text-right">청산가</th><th className="pb-6 text-right">미실현 손익(ROE%)</th><th className="pb-6"></th></tr></thead>
                                        <tbody>
                                            <tr className="text-sm font-bold border-t border-sky-50">
                                                <td className="py-6 flex items-center gap-2"><span className="text-sky-500 font-black">BTC Long</span><span className="bg-sky-50 text-sky-600 text-[10px] px-1.5 py-0.5 rounded border border-sky-100">10x</span></td>
                                                <td className="py-6 text-right font-mono">0.50 BTC</td>
                                                <td className="py-6 text-right font-mono text-slate-500">${entryPrice.toLocaleString()}</td>
                                                <td className="py-6 text-right font-mono"><span className="text-rose-500 bg-rose-50 px-2 py-1 rounded-lg">${currentLiqPrice.toLocaleString(undefined, { minimumFractionDigits: 1 })}</span></td>
                                                <td className="py-6 text-right"><div className="flex flex-col items-end"><span className={pnlData.uPnl >= 0 ? 'text-emerald-500' : 'text-rose-500'}>{pnlData.uPnl >= 0 ? '+' : ''}{pnlData.uPnl.toFixed(2)} USDT</span><span className={`text-[11px] ${pnlData.roe >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>({pnlData.roe >= 0 ? '+' : ''}{pnlData.roe.toFixed(2)}%)</span></div></td>
                                                <td className="py-6 text-right">
                                                    <div className="flex items-center justify-end gap-2">
                                                        <button onClick={() => setShowPnlCard(true)} className="p-2.5 bg-sky-50 text-sky-600 rounded-xl hover:bg-sky-500 hover:text-white transition-all"><i data-lucide="share-2" style={{width:'16px'}}></i></button>
                                                        <button className="bg-slate-900 text-white px-4 py-2 rounded-xl text-xs font-black">종료</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        {/* Trade Panel */}
                        <div className="col-span-12 lg:col-span-3 space-y-6">
                            <div className="bg-white rounded-[32px] p-6 border border-sky-100 shadow-sm">
                                <h3 className="text-xs font-black text-slate-400 mb-6 uppercase tracking-widest flex items-center gap-2">● 오더북</h3>
                                <div className="space-y-[2px] font-mono text-[11px] font-bold">
                                    {orderBookData.asks.map((item, i) => (<div key={`ask-${i}`} className="flex justify-between text-rose-500 bg-rose-50/30 px-3 py-1.5 rounded-lg border border-rose-100/20"><span>{item.price.toLocaleString(undefined, { minimumFractionDigits: 1 })}</span><span className="text-slate-400">{item.amount}</span></div>))}
                                    <div className="py-6 my-2 text-center bg-sky-50/10 border-y border-sky-50 rounded-xl"><div className="text-2xl font-black">${btcPrice.toLocaleString(undefined, { minimumFractionDigits: 1 })}</div><div className="text-[9px] font-black text-sky-500 uppercase mt-1">Live Sync</div></div>
                                    {orderBookData.bids.map((item, i) => (<div key={`bid-${i}`} className="flex justify-between text-sky-500 bg-sky-50/30 px-3 py-1.5 rounded-lg border border-sky-100/20"><span>{item.price.toLocaleString(undefined, { minimumFractionDigits: 1 })}</span><span className="text-slate-400">{item.amount}</span></div>))}
                                </div>
                            </div>
                            <div className="bg-white rounded-[40px] p-8 border border-sky-100 shadow-2xl shadow-sky-200/40 sticky top-24">
                                <div className="flex bg-sky-50/50 p-1.5 rounded-2xl mb-8">
                                    <button onClick={() => setActiveTab('long')} className={`flex-1 py-4 rounded-[18px] font-black text-sm transition-all ${activeTab === 'long' ? 'bg-sky-500 text-white shadow-lg' : 'text-slate-400'}`}>Long</button>
                                    <button onClick={() => setActiveTab('short')} className={`flex-1 py-4 rounded-[18px] font-black text-sm transition-all ${activeTab === 'short' ? 'bg-slate-900 text-white shadow-lg' : 'text-slate-400'}`}>Short</button>
                                </div>
                                <div className="space-y-6">
                                    <div><div className="flex justify-between mb-2 text-xs font-black text-slate-400">레버리지 {leverage}x</div><input type="range" min="1" max="100" value={leverage} onChange={(e) => setLeverage(Number(e.target.value))} className="w-full accent-sky-500" /></div>
                                    <div className="bg-slate-50 rounded-[24px] p-5 border-2 border-transparent focus-within:border-sky-400 transition-all"><div className="text-[10px] font-black text-sky-600 mb-1 uppercase">주문 수량</div><div className="flex justify-between items-center"><input type="number" placeholder="0.00" className="bg-transparent text-2xl font-black outline-none w-1/2" /><span className="font-black text-slate-400 text-lg">BTC</span></div></div>
                                    <div className="bg-sky-50/60 rounded-[24px] p-5 flex justify-between items-center"><span className="text-[11px] font-bold text-slate-500">예상 청산가</span><span className="text-sm font-mono font-black text-rose-500">${estimatedLiqPrice.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span></div>
                                    <button className={`w-full py-5 rounded-[24px] font-black text-lg shadow-xl transition-all ${activeTab === 'long' ? 'bg-sky-500 text-white hover:bg-sky-600' : 'bg-slate-900 text-white hover:bg-black'}`}>{isWalletConnected ? `${activeTab === 'long' ? '매수' : '매도'} 포지션 오픈` : '지갑 연결 필요'}</button>
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer className="fixed bottom-0 w-full bg-white/95 backdrop-blur-md border-t border-sky-100 py-3 px-8 hidden md:flex justify-between items-center z-[60]">
                        <div className="flex items-center gap-8"><div className="flex items-center gap-2 px-3 py-1 bg-sky-50 rounded-full border border-sky-100"><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_8px_#10b981]"></div><span className="text-[10px] font-black text-slate-700">BINANCE LIVE</span></div><div className="text-[10px] font-bold text-slate-400">24h Vol: ${(volume24h/1e6).toFixed(2)}M USDT</div></div>
                        <div className="text-[11px] font-black text-slate-400">{new Date().toLocaleTimeString()}</div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // 아이콘 렌더링을 위해 루사이드 라이브러리 실행
        useEffect(() => { lucide.createIcons(); });
    </script>
</body>
</html>
