<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>리나닷컴 대시보드 | 마이 페이백</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains_Mono:wght@400;700&display=swap');

        :root {
            --bg-deep: #0f0a1e;
            --brand-primary: #a855f7;
            --text-main: #f5f3ff;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-main);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 10% 10%, rgba(168, 85, 247, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(139, 92, 246, 0.08) 0%, transparent 40%);
            z-index: -1;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
        }

        .admin-section {
            background: rgba(168, 85, 247, 0.05);
            border: 1px dashed rgba(168, 85, 247, 0.3);
            border-radius: 24px;
        }

        .stat-value {
            font-family: 'JetBrains_Mono', monospace;
            letter-spacing: -0.05em;
        }

        .sidebar-item.active {
            background: rgba(168, 85, 247, 0.15);
            border-left: 3px solid #a855f7;
            color: #d8b4fe;
        }

        .input-dark {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px 14px;
            color: white;
            font-size: 13px;
            outline: none;
            width: 100%;
            transition: all 0.2s;
        }

        .input-dark:focus {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .btn-save {
            background: #a855f7;
            color: white;
            font-weight: 700;
            padding: 12px;
            border-radius: 12px;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
        }

        .btn-save:hover { background: #9333ea; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4); }
        .btn-save:active { transform: translateY(0); }

        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #a855f7;
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            right: 30px;
            bottom: 30px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        .modal-content {
            background: #1a142e;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
        }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.open { transform: translateX(0); }
        }
    </style>
</head>
<body class="min-h-screen flex">
    <div class="bg-mesh"></div>
    <div id="toast">설정이 저장되었습니다!</div>

    <!-- Asset Selection Modal -->
    <div id="asset-modal" class="modal-overlay" onclick="closeAssetModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white">GitHub 이미지 선택</h3>
                    <p class="text-[10px] text-white/40 mt-1">저장소: talmobottle1-boop/newtank26</p>
                </div>
                <button onclick="document.getElementById('asset-modal').style.display='none'" class="text-white/40 hover:text-white transition-colors p-2"><i class="fas fa-times"></i></button>
            </div>
            <div id="asset-list" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- Items loaded dynamically -->
            </div>
        </div>
    </div>

    <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-[#0a0515]/90 border-r border-white/5 z-50 lg:static lg:transform-none">
        <div class="p-6">
            <div class="flex items-center space-x-2.5 mb-10 cursor-pointer" onclick="location.href='index.html'">
                <div class="w-8 h-8 rounded-xl bg-gradient-to-br from-purple-500 to-purple-800 flex items-center justify-center shadow-lg">
                    <i class="fas fa-infinity text-white text-xs"></i>
                </div>
                <span class="text-lg font-bold italic tracking-tighter text-white">리나<span class="text-purple-500">닷컴</span></span>
            </div>

            <nav class="space-y-1">
                <a href="#summary" class="sidebar-item active flex items-center space-x-3 px-4 py-3.5 rounded-xl text-sm font-medium transition-all">
                    <i class="fas fa-th-large w-5"></i>
                    <span>종합 현황</span>
                </a>
                <a href="#admin-home" class="sidebar-item flex items-center space-x-3 px-4 py-3.5 rounded-xl text-sm font-medium text-white/40 hover:text-white transition-all">
                    <i class="fas fa-tools w-5"></i>
                    <span>홈페이지 관리</span>
                </a>
                <a href="#admin-exchange" class="sidebar-item flex items-center space-x-3 px-4 py-3.5 rounded-xl text-sm font-medium text-white/40 hover:text-white transition-all">
                    <i class="fas fa-list w-5"></i>
                    <span>거래소 목록 관리</span>
                </a>
            </nav>
        </div>
    </aside>

    <main class="flex-1 flex flex-col min-w-0">
        <header class="h-16 border-b border-white/5 flex items-center justify-between px-6 lg:px-10 bg-[#0f0a1e]/50 backdrop-blur-md sticky top-0 z-40">
            <div class="flex items-center">
                <button onclick="toggleSidebar()" class="lg:hidden text-white mr-4"><i class="fas fa-bars"></i></button>
                <h1 class="text-sm font-bold text-white/80 uppercase tracking-widest">Admin Control Panel</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-[10px] bg-red-500/20 text-red-400 px-2 py-1 rounded font-bold border border-red-500/30">관리자 모드 활성</div>
            </div>
        </header>

        <div class="p-6 lg:p-10 space-y-12 max-w-7xl mx-auto w-full">
            <!-- Stats Summary -->
            <section id="summary" class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-4">
                <div class="glass-card p-6 border-l-4 border-l-purple-500">
                    <p class="text-[11px] font-bold text-white/40 uppercase tracking-widest mb-2">총 환급액 관리</p>
                    <div class="flex items-baseline space-x-2">
                        <span id="stat-total" class="text-3xl font-bold stat-value text-white">12,450.50</span>
                        <span class="text-xs font-bold text-purple-400">USDT</span>
                    </div>
                </div>
                <div class="glass-card p-6">
                    <p class="text-[11px] font-bold text-white/40 uppercase tracking-widest mb-2">활성 연결 유저</p>
                    <div class="flex items-baseline space-x-2">
                        <span id="stat-users" class="text-3xl font-bold stat-value text-white">1,204</span>
                        <span class="text-xs font-bold text-emerald-400">명</span>
                    </div>
                </div>
                <div class="glass-card p-6">
                    <p class="text-[11px] font-bold text-white/40 uppercase tracking-widest mb-2">미처리 출금</p>
                    <div class="flex items-baseline space-x-2">
                        <span id="stat-withdraws" class="text-3xl font-bold stat-value text-white">3</span>
                        <span class="text-xs font-bold text-purple-400">건</span>
                    </div>
                </div>
            </section>

            <hr class="border-white/5">

            <!-- Home Settings -->
            <section id="admin-home" class="admin-section p-8 space-y-8">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center shadow-[0_0_15px_rgba(168,85,247,0.5)]"><i class="fas fa-bullhorn text-white"></i></div>
                    <h2 class="text-xl font-bold">상단 팝업 및 메인 헤더 설정</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <h3 class="text-xs font-black text-purple-400 uppercase tracking-widest">팝업 문구 및 버튼</h3>
                        <div class="space-y-3">
                            <label class="text-[11px] text-white/50">메인 팝업 텍스트</label>
                            <input type="text" id="top-popup-text" class="input-dark" value="지금 바이낸스 페이백 원해?">
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="text-[11px] text-white/50">거래소 버튼명</label><input type="text" id="top-popup-exchange" class="input-dark" value="바이낸스"></div>
                                <div><label class="text-[11px] text-white/50">액션 버튼명</label><input type="text" id="top-popup-action" class="input-dark" value="지금 연결"></div>
                            </div>
                            <div class="flex items-center space-x-2 pt-2">
                                <input type="checkbox" id="top-popup-hide" class="w-4 h-4 rounded bg-white/5 border-white/10 accent-purple-500">
                                <label for="top-popup-hide" class="text-xs text-red-400 font-bold">상단 팝업 숨기기 (삭제 효과)</label>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="text-xs font-black text-purple-400 uppercase tracking-widest">환급액 테스트 거래소 목록</h3>
                        <div class="space-y-3">
                            <label class="text-[11px] text-white/50">계산기에 표시될 거래소 (콤마로 구분)</label>
                            <textarea id="calc-exchanges" class="input-dark h-24">Binance, Bitget, Bybit, OKX, Deepcoin, Mexc</textarea>
                        </div>
                    </div>
                </div>
                <button onclick="saveSettings('home')" class="btn-save w-full md:w-auto px-10">설정 저장하기</button>
            </section>

            <!-- Exchange List Settings -->
            <section id="admin-exchange" class="glass-card p-8 space-y-8">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center shadow-[0_0_15px_rgba(99,102,241,0.5)]"><i class="fas fa-university text-white"></i></div>
                        <h2 class="text-xl font-bold">제휴 거래소 상세 관리</h2>
                    </div>
                    <button onclick="addExchangeRow()" class="px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-xs font-bold hover:bg-white/10 transition-all">+ 거래소 추가</button>
                </div>
                <div id="exchange-list" class="space-y-6"></div>
                <button onclick="saveSettings('exchange')" class="btn-save w-full">전체 거래소 목록 저장 및 동기화</button>
            </section>
        </div>

        <footer class="mt-auto py-10 px-6 border-t border-white/5 text-center">
            <p class="text-[10px] text-white/20 uppercase tracking-[0.2em] font-medium">LinaDotCom Admin Control System © 2025</p>
        </footer>
    </main>

    <script>
        // Updated GitHub Repository info based on provided path
        const GITHUB_USER = "talmobottle1-boop";
        const GITHUB_REPO = "newtank26"; 
        const GITHUB_BRANCH = "main";
        const ASSETS_PATH = "assets/images"; // New Path structure
        
        let currentEditingIndex = -1;
        let exchanges = [
            { id: 1, name: '비트겟 (Bitget)', rate: 81, color: 'from-[#00f0ff]/20', logo: 'https://raw.githubusercontent.com/talmobottle1-boop/newtank26/main/assets/images/bitget.png', link: 'https://partner.bitget.com/bg/LINA' },
            { id: 2, name: '바이낸스 (Binance)', rate: 30, color: 'from-[#f3ba2f]/20', logo: 'https://raw.githubusercontent.com/talmobottle1-boop/newtank26/main/assets/images/binance.png', link: 'https://accounts.binance.com/register?ref=LINA' }
        ];

        window.onload = function() {
            loadAllData();
            renderExchanges();
        };

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function renderExchanges() {
            const container = document.getElementById('exchange-list');
            container.innerHTML = '';
            exchanges.forEach((ex, index) => {
                const row = document.createElement('div');
                row.className = "p-6 bg-white/2 border border-white/5 rounded-2xl space-y-6 relative group hover:border-indigo-500/30 transition-all";
                row.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 bg-white/10 rounded p-2 flex items-center justify-center overflow-hidden">
                                <img id="preview-${index}" src="${ex.logo || ''}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" class="max-h-full">
                                <span class="hidden text-white/20 text-xs font-bold">?</span>
                            </div>
                            <input type="text" class="bg-transparent border-none text-white font-bold text-lg outline-none focus:ring-1 focus:ring-indigo-500 rounded px-1" value="${ex.name}" onchange="updateExData(${index}, 'name', this.value)">
                        </div>
                        <button onclick="deleteExchange(${index})" class="text-red-400 text-xs font-bold hover:text-red-300 transition-colors"><i class="fas fa-trash-alt mr-1"></i> 삭제</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div><label class="text-[10px] text-white/40 block mb-1 uppercase font-bold">페이백 요율 (%)</label><input type="number" class="input-dark" value="${ex.rate}" onchange="updateExData(${index}, 'rate', this.value)"></div>
                        <div><label class="text-[10px] text-white/40 block mb-1 uppercase font-bold">배경색 (Tailwind)</label><input type="text" class="input-dark" value="${ex.color}" onchange="updateExData(${index}, 'color', this.value)"></div>
                        <div>
                            <label class="text-[10px] text-white/40 block mb-1 uppercase font-bold">로고 이미지 URL</label>
                            <div class="flex space-x-2">
                                <input type="text" id="logo-input-${index}" class="input-dark" value="${ex.logo}" onchange="updateExData(${index}, 'logo', this.value); syncPreview(${index}, this.value);">
                                <button onclick="openAssetModal(${index})" class="whitespace-nowrap px-3 py-2 bg-purple-500/20 border border-purple-500/40 rounded-xl text-[10px] font-bold text-purple-300 hover:bg-purple-500/40 transition-all">로고 선택</button>
                            </div>
                        </div>
                    </div>
                    <div><label class="text-[10px] text-white/40 block mb-1 uppercase font-bold">연결하기 링크</label><input type="text" class="input-dark" value="${ex.link}" onchange="updateExData(${index}, 'link', this.value)"></div>
                `;
                container.appendChild(row);
            });
        }

        async function openAssetModal(index) {
            currentEditingIndex = index;
            const modal = document.getElementById('asset-modal');
            const list = document.getElementById('asset-list');
            modal.style.display = 'flex';
            list.innerHTML = `<div class="col-span-full py-20 text-center space-y-4"><i class="fas fa-spinner fa-spin text-purple-500 text-3xl"></i><p class="text-white/40 text-sm">연결 확인 중...</p></div>`;

            try {
                // Using the specific path provided: assets/images
                const cacheBuster = new Date().getTime();
                const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${ASSETS_PATH}?ref=${GITHUB_BRANCH}&t=${cacheBuster}`;
                
                const response = await fetch(apiUrl, {
                    headers: { 'Accept': 'application/vnd.github.v3+json' }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                const images = data.filter(item => 
                    item.type === 'file' && /\.(png|jpe?g|svg|webp|ico|gif)$/i.test(item.name)
                );

                if (images.length > 0) {
                    renderImageList(images);
                } else {
                    throw new Error("Empty folder");
                }
            } catch (err) {
                console.error("Asset Picker Error:", err);
                list.innerHTML = `
                    <div class="col-span-full py-16 text-center space-y-4">
                        <div class="w-16 h-16 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-2"><i class="fas fa-exclamation-triangle text-2xl"></i></div>
                        <p class="text-white font-bold">이미지를 불러올 수 없습니다.</p>
                        <p class="text-white/30 text-[10px] px-10 leading-relaxed">경로: ${GITHUB_USER}/${GITHUB_REPO}/${ASSETS_PATH}<br>저장소 설정이나 경로가 정확한지 확인해 주세요.</p>
                        <button onclick="openAssetModal(${index})" class="mt-4 px-6 py-2 bg-white/10 border border-white/20 rounded-xl text-xs hover:bg-white/20 transition-all">재시도</button>
                    </div>
                `;
            }
        }

        function renderImageList(images) {
            const list = document.getElementById('asset-list');
            list.innerHTML = '';
            images.forEach(img => {
                const imageUrl = img.download_url;
                const item = document.createElement('div');
                item.className = "bg-white/5 border border-white/10 rounded-xl p-4 cursor-pointer hover:border-purple-500 hover:bg-white/10 transition-all flex flex-col items-center gap-3 group relative overflow-hidden";
                item.onclick = () => selectLogo(imageUrl);
                item.innerHTML = `
                    <div class="w-14 h-14 flex items-center justify-center bg-white/5 rounded-lg overflow-hidden p-2">
                        <img src="${imageUrl}" class="max-h-full max-w-full object-contain group-hover:scale-110 transition-all" onerror="this.src='https://via.placeholder.com/50?text=Err'">
                    </div>
                    <span class="text-[10px] text-white/50 truncate w-full text-center group-hover:text-purple-300">${img.name}</span>
                `;
                list.appendChild(item);
            });
        }

        function selectLogo(url) {
            if (currentEditingIndex !== -1) {
                updateExData(currentEditingIndex, 'logo', url);
                syncPreview(currentEditingIndex, url);
                document.getElementById(`logo-input-${currentEditingIndex}`).value = url;
                document.getElementById('asset-modal').style.display = 'none';
                showToast("로고가 선택되었습니다.");
            }
        }

        function syncPreview(index, url) {
            const img = document.getElementById(`preview-${index}`);
            if (img) { img.style.display = 'block'; img.src = url; }
        }

        function updateExData(index, key, value) { if (exchanges[index]) exchanges[index][key] = value; }

        function addExchangeRow() {
            exchanges.push({ id: Date.now(), name: '새 거래소', rate: 50, color: 'from-purple-500/20', logo: '', link: '#' });
            renderExchanges();
            showToast("항목 추가됨");
        }

        function deleteExchange(index) {
            if(confirm('삭제하시겠습니까?')) {
                exchanges.splice(index, 1);
                renderExchanges();
                showToast("삭제됨");
            }
        }

        function saveSettings(section) {
            if (section === 'home') {
                const data = {
                    topText: document.getElementById('top-popup-text').value,
                    topExchange: document.getElementById('top-popup-exchange').value,
                    topAction: document.getElementById('top-popup-action').value,
                    topHide: document.getElementById('top-popup-hide').checked,
                    calcExchanges: document.getElementById('calc-exchanges').value
                };
                localStorage.setItem('lina_home_settings', JSON.stringify(data));
            } else if (section === 'exchange') {
                localStorage.setItem('lina_exchange_list', JSON.stringify(exchanges));
            }
            showToast("설정이 로컬에 저장되었습니다.");
        }

        function loadAllData() {
            const home = JSON.parse(localStorage.getItem('lina_home_settings'));
            if(home) {
                document.getElementById('top-popup-text').value = home.topText;
                document.getElementById('top-popup-exchange').value = home.topExchange;
                document.getElementById('top-popup-action').value = home.topAction;
                document.getElementById('top-popup-hide').checked = home.topHide;
                document.getElementById('calc-exchanges').value = home.calcExchanges;
            }
            const savedEx = JSON.parse(localStorage.getItem('lina_exchange_list'));
            if(savedEx) exchanges = savedEx;
        }

        function showToast(msg) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.className = "show";
            setTimeout(() => { toast.className = ""; }, 3000);
        }

        function closeAssetModal(e) { if (e.target.id === 'asset-modal') document.getElementById('asset-modal').style.display = 'none'; }
    </script>
</body>
</html>
