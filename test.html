
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SSX OTT - 정주행의 시작</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #05070a;
            color: white;
            overscroll-behavior-y: contain;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .movie-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .movie-card:active {
            transform: scale(0.92);
        }

        #player-overlay, #upload-modal {
            display: none;
            backdrop-filter: blur(25px);
            background-color: rgba(0, 0, 0, 0.95);
        }

        .loading-spinner {
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        video, iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #local-file-input, #local-image-input {
            display: none;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: white;
            width: 100%;
            outline: none;
        }
        .input-field:focus {
            border-color: #3b82f6;
        }

        .image-preview-box {
            width: 100%;
            aspect-ratio: 2/3;
            background: rgba(255, 255, 255, 0.03);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        .image-preview-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="pb-24 select-none">

    <!-- 숨김 input 요소들 -->
    <input type="file" id="local-file-input" accept="video/*" onchange="openUploadModal(event)">
    <input type="file" id="local-image-input" accept="image/*" onchange="previewThumbnail(event)">

    <!-- 상단 헤더 -->
    <nav class="fixed top-0 w-full z-[100] bg-[#05070a]/80 backdrop-blur-xl px-5 py-4 border-b border-white/5 flex items-center justify-between">
        <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-400 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i data-lucide="play" class="fill-white text-white w-4 h-4 ml-0.5"></i>
            </div>
            <span class="text-xl font-black italic tracking-tighter uppercase">
                SSX<span class="text-blue-500 ml-0.5">OTT</span>
            </span>
        </div>
        <div class="flex items-center space-x-5">
            <button onclick="triggerFileInput()" class="flex items-center space-x-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-full transition-all shadow-lg shadow-blue-600/20">
                <i data-lucide="plus-circle" class="w-4 h-4 text-white"></i>
                <span class="text-[10px] font-bold text-white">콘텐츠 등록</span>
            </button>
            <i data-lucide="search" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-white transition-colors"></i>
            <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-gray-800 to-gray-950 border border-white/10 flex items-center justify-center">
                <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
            </div>
        </div>
    </nav>

    <!-- 카테고리 -->
    <div id="category-bar" class="pt-20 px-5 overflow-x-auto no-scrollbar flex space-x-2 pb-4">
        <!-- JS Dynamic Content -->
    </div>

    <!-- 메인 추천 콘텐츠 -->
    <section class="px-5 mb-8">
        <div class="relative aspect-[16/9] rounded-3xl overflow-hidden shadow-2xl group cursor-pointer" 
             onclick="playDriveVideo('1zHSwE_tSNhJpFTe7fkNpQGK6GT4FIZFm', '오징어 게임 시즌2', '456억 원, 다시 시작되는 서바이벌.')">
            <div class="absolute inset-0 bg-gradient-to-br from-red-950/40 to-black"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-[#05070a] via-transparent to-transparent z-10"></div>
            <div class="absolute bottom-6 left-6 z-20 space-y-1">
                <div class="flex items-center space-x-2 mb-1">
                    <span class="px-2 py-0.5 bg-red-600 text-[9px] font-black rounded">HOT</span>
                    <span class="text-[10px] font-bold text-gray-300">SSX ORIGINAL</span>
                </div>
                <h2 class="text-2xl font-black tracking-tight">오징어 게임 2</h2>
                <p class="text-[11px] text-gray-400 font-medium">진짜 게임이 다시 시작됩니다.</p>
            </div>
            <div class="absolute bottom-6 right-6 z-20 w-12 h-12 rounded-full bg-white text-black flex items-center justify-center shadow-2xl transition-transform active:scale-90">
                <i data-lucide="play" class="fill-black text-black w-5 h-5 ml-1"></i>
            </div>
        </div>
    </section>

    <!-- 콘텐츠 리스트 -->
    <section class="px-5 space-y-6">
        <div class="flex justify-between items-center px-1">
            <h3 class="text-md font-bold flex items-center space-x-2 tracking-tight">
                <i data-lucide="sparkles" class="w-4 h-4 text-blue-400"></i>
                <span>실시간 인기 트렌드</span>
            </h3>
            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-600"></i>
        </div>

        <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
            <!-- Loading Skeleton -->
        </div>
    </section>

    <!-- 업로드 모달 -->
    <div id="upload-modal" class="fixed inset-0 z-[300] flex items-center justify-center p-4">
        <div class="w-full max-w-4xl max-h-[90vh] bg-[#121418] rounded-3xl overflow-hidden border border-white/10 shadow-2xl flex flex-col md:flex-row">
            <!-- 왼쪽: 이미지 미리보기/등록 -->
            <div class="w-full md:w-1/3 p-8 border-b md:border-b-0 md:border-r border-white/5 bg-black/20">
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-1 mb-2 block">커버 이미지 등록</label>
                <div class="image-preview-box" onclick="triggerImageInput()" id="thumbnail-preview-container">
                    <i data-lucide="image-plus" class="w-10 h-10 text-gray-600 mb-2"></i>
                    <p class="text-[11px] text-gray-500 font-bold">이미지 선택</p>
                    <div id="preview-img-holder" class="absolute inset-0 hidden">
                        <img id="preview-img" src="" alt="Thumbnail Preview">
                    </div>
                </div>
                <p class="text-[9px] text-gray-600 mt-3 leading-relaxed text-center italic">포스터 형식(2:3 비율)의 이미지를 권장합니다.</p>
            </div>

            <!-- 오른쪽: 정보 입력 -->
            <div class="flex-1 p-8 space-y-6 overflow-y-auto no-scrollbar">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-black italic">상세 정보 입력</h3>
                    <button onclick="closeUploadModal()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">콘텐츠 제목</label>
                        <input type="text" id="upload-title" class="input-field mt-1" placeholder="영상 제목을 입력하세요">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">카테고리</label>
                        <select id="upload-category" class="input-field mt-1">
                            <option value="드라마">드라마</option>
                            <option value="영화">영화</option>
                            <option value="예능">예능</option>
                            <option value="애니">애니</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">출시 연도</label>
                        <input type="number" id="upload-year" class="input-field mt-1" value="2025">
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">상세 내용</label>
                        <textarea id="upload-desc" class="input-field mt-1 h-24 resize-none" placeholder="영상에 대한 설명을 입력하세요"></textarea>
                    </div>
                </div>
                <button onclick="confirmUpload()" class="w-full py-4 bg-blue-600 rounded-2xl font-black text-white shadow-xl shadow-blue-600/20 active:scale-95 transition-all">
                    업로드 및 등록 완료
                </button>
            </div>
        </div>
    </div>

    <!-- 하단 네비게이션 -->
    <div class="fixed bottom-0 w-full bg-[#05070a]/90 backdrop-blur-2xl border-t border-white/5 px-8 py-3 flex justify-between items-center z-[100] pb-8">
        <div class="flex flex-col items-center space-y-1 text-blue-500 cursor-pointer">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span class="text-[9px] font-bold">홈</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 cursor-pointer">
            <i data-lucide="play-circle" class="w-5 h-5"></i>
            <span class="text-[9px] font-bold">뉴&핫</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 cursor-pointer">
            <i data-lucide="heart" class="w-5 h-5"></i>
            <span class="text-[9px] font-bold">찜한목록</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 cursor-pointer">
            <i data-lucide="menu" class="w-5 h-5"></i>
            <span class="text-[9px] font-bold">더보기</span>
        </div>
    </div>

    <!-- 플레이어 레이어 -->
    <div id="player-overlay" class="fixed inset-0 z-[200] flex flex-col items-center justify-center">
        <div class="w-full h-full max-w-5xl flex flex-col">
            <div class="flex justify-between items-center p-6">
                <button onclick="closePlayer()" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white active:scale-90 transition-all">
                    <i data-lucide="chevron-left" class="w-6 h-6"></i>
                </button>
                <span id="player-source-type" class="text-sm font-bold text-gray-400 uppercase tracking-widest">Streaming Source</span>
                <div class="w-10"></div>
            </div>
            <div id="video-wrapper" class="relative w-full aspect-video bg-black shadow-2xl border-y border-white/5">
                <div id="video-loader" class="absolute inset-0 flex flex-col items-center justify-center space-y-3 z-30 bg-black">
                    <div class="w-10 h-10 border-4 border-blue-500 loading-spinner rounded-full"></div>
                    <p class="text-[11px] font-bold text-gray-500 tracking-widest">LOADING CONTENT...</p>
                </div>
                <div id="player-target" class="w-full h-full flex items-center justify-center"></div>
            </div>
            <div class="flex-1 p-6 overflow-y-auto no-scrollbar">
                <div id="player-info" class="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500"></div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const categories = ['전체', '드라마', '영화', '예능', '애니'];
        let movies = [];
        let activeCategory = '전체';
        
        let pendingFile = null;
        let pendingThumbnailUrl = null;

        async function init() {
            lucide.createIcons();
            renderCategories();
            await fetchMovies();
        }

        function renderCategories() {
            const bar = document.getElementById('category-bar');
            bar.innerHTML = categories.map(cat => `
                <button onclick="setCategory('${cat}')" class="px-5 py-2 rounded-2xl text-[12px] font-bold flex-shrink-0 transition-all border ${
                    activeCategory === cat 
                    ? 'bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-500/20 scale-105' 
                    : 'bg-white/5 border-white/5 text-gray-500'
                }">${cat}</button>
            `).join('');
        }

        function setCategory(cat) {
            activeCategory = cat;
            renderCategories();
            renderMovies();
        }

        async function fetchMovies() {
            try {
                const prompt = `2024-2025년 한국 인기 콘텐츠 12개. JSON: { "contents": [{ "title": "제목", "type": "드라마/영화/예능", "year": "2025", "desc": "요약", "driveId": "ID" }] }`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                const json = JSON.parse(data.candidates[0].content.parts[0].text);
                
                movies = json.contents.map((m, i) => ({
                    ...m,
                    id: Date.now() + i,
                    driveId: i === 0 ? '1zHSwE_tSNhJpFTe7fkNpQGK6GT4FIZFm' : (m.driveId && m.driveId !== "ID" ? m.driveId : '1zHSwE_tSNhJpFTe7fkNpQGK6GT4FIZFm'),
                    color: ['#1e40af', '#3730a3', '#9f1239', '#115e59'][i % 4],
                    isLocal: false
                }));
                renderMovies();
            } catch (e) {
                console.error("Fetch Error", e);
            }
        }

        function renderMovies() {
            const grid = document.getElementById('movie-grid');
            const filtered = activeCategory === '전체' ? movies : movies.filter(m => m.type === activeCategory);
            
            grid.innerHTML = filtered.map(m => `
                <div onclick="${m.isLocal ? `playLocalVideo('${m.fileUrl}', '${m.title}', '${m.desc}')` : `playDriveVideo('${m.driveId}', '${m.title}', '${m.desc}')`}" 
                     class="movie-card relative aspect-[2/3] rounded-2xl overflow-hidden bg-[#0f1218] shadow-lg group cursor-pointer">
                    
                    ${m.thumbnailUrl ? `
                        <img src="${m.thumbnailUrl}" class="absolute inset-0 w-full h-full object-cover transition-transform group-hover:scale-110 duration-500">
                    ` : `
                        <div class="absolute inset-0 opacity-40 group-hover:opacity-60 transition-opacity" style="background: linear-gradient(135deg, ${m.color || '#3b82f6'}, transparent)"></div>
                    `}

                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-80"></div>
                    
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-active:opacity-100 transition-opacity z-10">
                        <i data-lucide="play" class="w-10 h-10 fill-white text-white"></i>
                    </div>
                    
                    ${m.isLocal ? `
                        <div class="absolute top-2 left-2 z-20">
                            <span class="px-1.5 py-0.5 bg-blue-600 text-[8px] font-bold rounded shadow-lg">LOCAL</span>
                        </div>
                    ` : ''}

                    <div class="absolute bottom-0 left-0 w-full p-4 z-20">
                        <span class="text-[8px] font-bold text-blue-400 block mb-1 uppercase tracking-widest">${m.type}</span>
                        <h4 class="text-[13px] font-black truncate">${m.title}</h4>
                        <p class="text-[9px] text-gray-400 mt-1 line-clamp-1">${m.desc}</p>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- 업로드 로직 ---
        function triggerFileInput() {
            document.getElementById('local-file-input').click();
        }

        function triggerImageInput() {
            document.getElementById('local-image-input').click();
        }

        function openUploadModal(event) {
            const file = event.target.files[0];
            if (!file) return;
            pendingFile = file;
            
            // 초기화
            document.getElementById('upload-title').value = file.name.split('.').slice(0, -1).join('.');
            document.getElementById('upload-modal').style.display = 'flex';
            document.getElementById('preview-img-holder').classList.add('hidden');
            pendingThumbnailUrl = null;
        }

        function previewThumbnail(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            pendingThumbnailUrl = URL.createObjectURL(file);
            document.getElementById('preview-img').src = pendingThumbnailUrl;
            document.getElementById('preview-img-holder').classList.remove('hidden');
        }

        function closeUploadModal() {
            document.getElementById('upload-modal').style.display = 'none';
            pendingFile = null;
            // 썸네일 메모리 해제는 등록 시 혹은 취소 시 신중히 (이 앱은 SPA라 유의)
        }

        function confirmUpload() {
            const title = document.getElementById('upload-title').value;
            const category = document.getElementById('upload-category').value;
            const desc = document.getElementById('upload-desc').value;
            const year = document.getElementById('upload-year').value;

            if (!title) return;

            const fileUrl = URL.createObjectURL(pendingFile);
            
            const newContent = {
                id: Date.now(),
                title: title,
                type: category,
                desc: desc || "사용자가 업로드한 로컬 콘텐츠입니다.",
                year: year || "2025",
                fileUrl: fileUrl,
                thumbnailUrl: pendingThumbnailUrl,
                isLocal: true,
                color: '#3b82f6'
            };

            movies.unshift(newContent);
            renderMovies();
            closeUploadModal();
        }

        // --- 재생 로직 ---
        function playLocalVideo(url, title, desc) {
            openPlayerOverlay();
            document.getElementById('player-source-type').innerText = "Local PC Storage";
            const target = document.getElementById('player-target');
            target.innerHTML = `<video id="main-video-player" controls autoplay class="w-full h-full"><source src="${url}" type="video/mp4"></video>`;
            updatePlayerInfo(title, desc);
            hideLoader();
        }

        function playDriveVideo(driveId, title, desc) {
            openPlayerOverlay();
            document.getElementById('player-source-type').innerText = "Google Drive Streaming";
            const target = document.getElementById('player-target');
            target.innerHTML = `<div class="video-container"><iframe src="https://drive.google.com/file/d/${driveId}/preview" allow="autoplay; fullscreen" allowfullscreen></iframe></div>`;
            updatePlayerInfo(title, desc);
            setTimeout(hideLoader, 2000);
        }

        function openPlayerOverlay() {
            const overlay = document.getElementById('player-overlay');
            const loader = document.getElementById('video-loader');
            overlay.style.display = 'flex';
            loader.style.display = 'flex';
            loader.style.opacity = '1';
            document.body.style.overflow = 'hidden';
        }

        function updatePlayerInfo(title, desc) {
            const info = document.getElementById('player-info');
            info.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="space-y-1">
                        <h2 class="text-2xl font-black tracking-tight">${title}</h2>
                        <div class="flex items-center space-x-3 text-[11px] font-bold text-gray-400">
                            <span class="text-blue-500 font-black">USER CONTENT</span>
                            <span>2025</span>
                            <span class="px-1.5 py-0.5 border border-gray-700 rounded-sm text-[8px]">LOCAL STREAMING</span>
                        </div>
                    </div>
                </div>
                <p class="text-sm text-gray-300 leading-relaxed font-medium">${desc}</p>
            `;
            lucide.createIcons();
        }

        function hideLoader() {
            const loader = document.getElementById('video-loader');
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        }

        function closePlayer() {
            const overlay = document.getElementById('player-overlay');
            const target = document.getElementById('player-target');
            overlay.style.display = 'none';
            target.innerHTML = ''; 
            document.body.style.overflow = 'auto';
        }

        init();
    </script>
</body>
</html>
